#!/bin/sh
#/ Usage: git-mirror <repository> <directory>
#/
#/ Mirror the given git URL into the given directory, setting up the destination
#/ repository if necessary before pulling in changes from the remote.
set -e

repourl="$1"
destdir="$2"

# usage and help
if test $# -eq 0 || test -z "$repourl" || test -z "$destdir"
then
    cat "$0" | grep '^#/' | cut -c4- 1>&2
    exit 1
fi

# perform the initial clone if the mirror doesn't exist yet
if ! test -d "$destdir"
then
    git clone -q --mirror "$repourl" "$destdir">/dev/null
fi

# sync changes from the remote repository
git --git-dir="$destdir" fetch -ap origin
