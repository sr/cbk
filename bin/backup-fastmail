#!/bin/sh
set -e

: ${MAILDIR:="${HOME}/Documents/Maildir"}

# one way sync from fastmail.com
offlineimap -c "${HOME}/etc/offlineimaprc"

# setup git repository
GIT_WORK_TREE="$MAILDIR"
GIT_DIR="$MAILDIR/.git"
export GIT_WORK_TREE GIT_DIR

# commit changes if any
test -n "$(git status --porcelain)" && {
    git add . >/dev/null
    git commit --allow-empty-message --no-edit >/dev/null
}

git gc --aggressive
git repack
