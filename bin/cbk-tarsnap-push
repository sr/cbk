#!/bin/sh
#/ Usage: cbk-tarsnap-push
set -e

cd $(dirname "$0")/..
. share/cbk/cbk-config

hostname="$(hostname -f)"
archivetype="daily"
timestamp="$(date -u "+%Y-%m-%d_%H:%M:%S")"
archive="${hostname}-${archivetype}-${timestamp}-github"

exec tarsnap -c \
    --keyfile "$CBK_TARSNAP_KEYFILE" \
    --cachedir "$CBK_TARSNAP_CACHE_DIR" \
    -f "$archive" \
    -C / \
    -v \
    "$CBK_GITHUB_DIR"
