#!/bin/sh
#/ Usage: cbk-pull
#/ Pull down cloud data onto the local host.
set -e

cd $(dirname "$0")/..
. share/cbk/cbk-config

# Mirror all accessible GitHub repositories
start=$(date +"%s")
echo "at=start cloud=github" 1>&2
cbk-pull-github
echo "at=finish cloud=github duration=$(($(date +'%s') - $start))s" 1>&2

# Fetch email data from Fastmail over IMAP
start=$(date +"%s")
echo "at=start cloud=fastmail-imap" 1>&2
cbk-pull-fastmail-imap
echo "at=finish cloud=fastmail-imap duration=$(($(date +"%s") - $start))s" 1>&2

# Fetch contact/CardDAV data from Fastmail
start=$(date +"%s")
echo "at=start cloud=fastmail-carddav" 1>&2
cbk-pull-fastmail-carddav
echo "at=finish cloud=fastmail-carddav" \
    "duration=$(($(date +"%s") - $start))s" 1>&2

# Copy irc chat logs from the local machine
start=$(date +"%s")
echo "at=start cloud=irclogs" 1>&2
cbk-pull-irclogs
echo "at=finish cloud=irclogs duration=$(($(date +"%s") - $start))s" 1>&2
