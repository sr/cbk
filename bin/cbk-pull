#!/bin/sh
#/ Usage: cbk-pull
#/ Pull down cloud data onto the local host.
set -e

cd $(dirname "$0")/..
. share/cbk/cbk-config

cbk_pull() {
    cloud="$1"
    pullcommand="cbk-pull-$cloud"
    start=$(date +"%s")

    echo "at=start cloud=$cloud" 1>&2

    if $pullcommand
    then
        duration="$(($(date +'%s') - $start))"
        echo "at=finish cloud=$cloud duration=$duration" 1>&2
    else
        echo "at=error cloud=$cloud" 1>&2
    fi
}

# Mirror all accessible GitHub repositories
cbk_pull "github"

# Fetch email data from Fastmail over IMAP
cbk_pull "fastmail-imap"

# Fetch contact/CardDAV data from Fastmail
cbk_pull "fastmail-carddav"

# Copy irc chat logs from the local machine
cbk_pull "irclogs"
